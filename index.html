<html>

<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/1.12.1/d3-annotation.min.js"></script>
    <script>
        function show(num) {
            document.getElementById("svg" + num).focus();
        }
    </script>
    <title>COVID Interactive Slideshow Narration</title>
    <style>
        hr {
            width: 80%;
            height: 8px;
            margin-left: auto;
            margin-right: auto;
            background-color: saddlebrown;
            border: 0 none;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .bar {
            fill: darkgreen;
        }
        
        .tallestbar {
            fill: yellow;
        }
        
        .smallestbar {
            fill: gray;
        }
        
        .highlight {
            fill: orange;
        }
        
        .title {
            fill: blue;
            font-weight: bold;
        }
        
        body {
            background-color: whitesmoke;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        td {
            border: 2px solid black;
        }
        
        :root {
            --line-chart-color: #607D8B;
            --annotation-context-color: #00796B;
            --annotation-above-color: #A02FA5;
            --annotation-anomaly-color: #E8336D;
        }
        
        svg {
            background-color: white;
            font-family: 'Lato';
        }
        
        .axis,
        .axis text {
            fill: var(--line-chart-color);
        }
        
        .axis line,
        path {
            stroke: var(--line-chart-color);
        }
        
        path {
            fill: none;
        }
        
        .annotation path {
            stroke: var(--annotation-context-color);
        }
        
        .annotation:not(.above):not(.anomaly) path {
            stroke-dasharray: 1, 3;
        }
        
        .annotation text {
            fill: var(--annotation-context-color);
        }
        
        .annotation.above path {
            stroke: var(--annotation-above-color);
        }
        
        .annotation.above text {
            fill: var(--annotation-above-color);
        }
        
        .annotation.anomaly path {
            stroke: var(--annotation-anomaly-color);
            stroke-width: 2px;
        }
        
        .annotation.anomaly text {
            fill: var(--annotation-anomaly-color);
        }
        
        .annotation-note-bg {
            fill: rgba(0, 0, 0, 0);
        }
        
        .annotation-note-title {
            font-weight: bold;
        }
        
        text.title {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>

<body onload='init()'>
    <font size="6" color="#1c87c9" face="arial"><b><div id="firstElement" align="center">COVID Data From March 2020 till July 2021</div></b></font>
    <h4 align="center">Interactive Slideshow Narrative Visualtion Created by Amit Agrawal(amita3@illinois.edu) CS416 Summer 2021</h4>
    <br> This page is using 2 different sets of COVID data available on github.
    <br>
    <ul>
        <li>Dataset 1 :- <a href="https://github.com/nytimes/covid-19-data/blob/master/rolling-averages/us.csv">https://github.com/nytimes/covid-19-data/blob/master/rolling-averages/us.csv</a> - This has rolling average COVID data for USA.</li>
        <li>Dataset 2 :- <a href="https://github.com/nytimes/covid-19-data/blob/master/rolling-averages/us-states.csv">https://github.com/nytimes/covid-19-data/blob/master/rolling-averages/us-states.csv</a> - This has rolling average data for each states in USA.</li>
    </ul>
    Both the datasets are stored locally on github along with this webpage. HTTP calls to the above link was blocked by CORS policy and to overcome it, I stored a local copy of the data along with the webpage.
    <br> NOTE: The US territories "Northern Mariana Islands", "Guam", "Virgin Islands" do not have good data so they have been excluded from the datasets across all scenes.
    <p>
        <font size="6" color="#1c87c9" face="arial"><b>Message</b></font>
        <br> What is the message you are trying to communicate with the narrative visualization?
        <br> The charts on the slides are showing confirmed cases in 2020 and 2021. The aim here is to provide a way to user to slice &amp; dice the data in such a way to make it easy for them to figure out e.g. What is the time perdion when USA had most number of COVID cases were rising and in what time period, it was declining? Some states had very low numer of cases where as some states like California, New York had huge spike. Chart shows that which state was doing better in managing the COVID situation and which one was doing worse.
        <br>
        <br>For Slide 2 and 3, same dataset is being used but it is sliced &amp; diced in a different way to perform 2 different analysis. Data is filtered on the fly for the selected month which shows in that month, what was the average number of cases across US states. Then using same dataset, data is filtered on the fly for the selected month and the selected state, showing the daily number of covid cases in that state.
    </p>

    <p>
        <br><font size="6" color="#1c87c9" face="arial"><b>Narrative Structure</b></font>
        <br> I have chosen Interactive Slideshow structure. I am displayin monthly average number of cases and in order to analyze data in each month, across US states OR for a given state, User sholud be go back and forth between the slides and structure should allow an easy oppotunity to choose a different data point for analysis. Slide 1 and Slide 2 offers user interaction. In slide 1, it shows a bar chart. User can click on bars to select different month. For the selected month, the number of covid confirmed cases are displayed in slide 2. User has an opportunity to select a state here.
        <br>User can go back from Slide 2 to Slide 1 OR Slide 3 to Slide 1 adn can change the selection.


    </p>
    <p>
        <br><font size="6" color="#1c87c9" face="arial"><b>Visual Structure</b></font>
        <br> I have choosen Bar charts to display the data across all 3 slides. With bars, their length or height on Y axis is according to the data we want to show. One can easily find low bars and high bars. To focus on the highest and lowest, I have put annotations with the data pointing to the bar. With annotations, a user is focused on that data point. and when user clicks the bar, user is taken to next slide.
        <br>Each slide has a title that shows what analysis is being in this slide based on the selection made in previous slide. The datapoint selection is the key that connects the 2 slides/scenes.


    </p>

    <br><font size="6" color="#1c87c9" face="arial"><b>Scene</b></font>
    <br> What are the scenes of your narrative visualization? How are the scenes ordered, and why There are 3 scenes or slides. The first slide is showing the data at country level by dates and then ability to analyze data at state level. Showing data at country level give a quick overview on covid cases that in which time period numbers were rising or declining or were flat. At any time, User can switch between scenes/slides and choose a different data point for further analysis.
    <ul>
        <li><b>Scene 1</b> :- It shows average number of COVID cases by month end dates. X axis of the bar chart has month end dates and y-axis has monthly average cases. In USA, Which month end has highest rolling average? High number of confirmed cases shows the time period when COVID situation was worse and low number of cases shows the period when number of confirmed cases were declining.</li>
        <li><b>Scene 2</b> :- For the selected month in Slide 1, it shows the average number of confirmed cases across all US States. Some states had very low numer where as some states like California, New York had huge spike. We can depict which state was doing better in managing the COVID situation and which one was doing worse. User can select a state here to see daily data for that month.</li>
        <li><b>Scene 3</b> :- For the selected month and selected US state in slide 2, <b>daily</b> confirmed cases are displayed. It depicts the rise or fall in COVID cases in the selected month and US state. With the daily data for a state, one can depict the situation of COVID in that state i.e. on the rise or flat or decline.</li>
    </ul>

    <p>
        <br><font size="6" color="#1c87c9" face="arial"><b>Annotations</b></font>
        <br> In this narration, we have 3 scenes with consistent anntations. All 3 scenes are showing the highest and lowest number of COVID cases with annotations. It quickly brings user's attention to those data points. Besides that, the color of the bar is also made different. If a different selection is made, the highest and lowest annotations are re-displayed according to the latest selection.
        <br> On scrolling over the bars, the actual data point value is being displayed over the bar as tooltip/text.




    </p>


    <p>
        <br><font size="6" color="#1c87c9" face="arial"><b>Parameters</b></font>
        <br> Scene 1 feedng the input parameter to Scene 2. From the select date, numbers of average cases are displayed for all te US states. In scene 2, user can select a state by clicking on the bar. At this point, the selected date from Scene 1 and selected State from Scene2 becomes teh input parameters for Scene 3. From teh selected date, year and month is extracted. For the year, month and selected State, Scene 3 shows the daily number of covid cases.


    </p>
    <p>
        <br><font size="6" color="#1c87c9" face="arial"><b>Triggers</b></font>
        <br> In Scene 1 and Scene 2, user can click on bars to make a selection. After the selection, users is automatically progressed to next scene i.e. if user selects a date in Scene 1, then user is progressed to Scene 2 automtically. The data point selection or click is a triggering action. Similarly, in Scene 2, after state selection, user is progressed ot Scene 3.
        <br>
        <br>All Scene/Slide numbers are displayed in each scenes. User can click on the scene number to go back and forth between scenes.


    </p>



    <br>
    <div id="svg1header2">
        <hr>
        <table cellpadding=10>
            <tr>
                <th>Slides: </th>
                <td bgcolor="orange">1</td>
                <td><a href="#svg2header2">2</a></td>
                <td><a href="#svg3header2">3</a></td>
            </tr>
        </table>

        <h5>
            This chart is showing Month end dates with the average number of new cases reported that day and the six days prior. In other words, the seven-day trailing average.
            
            Mention on the Dates about highest and lowest number of cases
            
            Click on Bars to see average cases by US states for the selected Date in next slide.
        
        
        
        </h5>
        <svg id="svg1" width="1200" height="500"></svg>


        <div id="svg2header2">
            <hr>
            <h4 id="svg2header1">Please click on Bars to select date in Scene/Slide 1.</h4>
            <h5 id="svg2title">Click on Bars to see Daily cases in selected Month and US State in next slide.</h5>
            <table id="svg2slideTbl" cellpadding=10>
                <tr>
                    <th>Slides: </th>
                    <td><a href="#svg1header2">1</a></td>
                    <td bgcolor="orange">2</td>
                    <td><a href="#svg3header2">3</a></td>
                </tr>
            </table>


            <svg id="svg2" width="1200" height="500"></svg>

            <div id="svg3header2">
                <hr>
                <h4 id="svg3header1">Please click on bar to select Year/Month and US State in Scene/Slide 2.</h4>
                <h5 id="svg3title">
                    COVID confirmed cases for the selected month across all US states. The states with high population had high number of COVID cases.     <br>
                    Chart Showing Daily cases in selected Month and US State.
                </h5>
                <table id="svg3slideTbl" cellpadding=10>
                    <tr>
                        <th>Slides: </th>
                        <td><a href="#svg1header2">1</a></td>
                        <td><a href="#svg2header2">2</a></td>
                        <td bgcolor="orange">3</td>
                    </tr>
                </table>


                <svg id="svg3" width="1200" height="500"></svg>
            </div>
        </div>
        <script>
            var dataset1;
            var dataset2;
            var showToolTip = true;

            document.getElementById("svg2title").style.display = "none";
            document.getElementById("svg3title").style.display = "none";


            async function init() {
                dataset1 = await d3.csv("./us.csv", ({
                    date, cases, cases_avg
                }) => ({
                    date: date,
                    cases: +cases,
                    cases_avg: +cases_avg
                }))
                dataset2 = await d3.csv("./us-states.csv", ({
                    date, state, cases, cases_avg, deaths
                }) => ({
                    date: date,
                    state: state,
                    cases: +cases,
                    cases_avg: +cases_avg,
                    deaths: +deaths
                }))

                var monthendDates = ['2020-03-31', '2020-04-30', '2020-05-31', '2020-06-30', '2020-07-31',
                                   '2020-08-31', '2020-09-30', '2020-10-31', '2020-11-30', '2020-12-31', 
                                     '2021-01-31', '2021-02-28',
                                  '2021-03-31', '2021-04-30', '2021-05-31', '2021-06-30', '2021-07-31']


                dataset1 = dataset1.filter(function (el) {
                    return monthendDates.includes(el.date);
                });

                excludeStates = ["Northern Mariana Islands", "Guam", "Virgin Islands"]
                dataset2 = dataset2.filter(function (el) {
                    return !excludeStates.includes(el.state);
                });


                var svg1 = d3.select("#svg1");
                margin = 250;
                width = svg1.attr("width") - margin;
                height = svg1.attr("height") - margin;

                svg1.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 10).attr("y", 50)
                    .attr("font-size", "20px")
                    .attr("class", "title")
                    .text("Average COVID Cases in USA")

                var x = d3.scaleBand().range([0, width]).padding(0.6),
                    y = d3.scaleLinear().range([height, 0]);

                var g = svg1.append("g")
                    .attr("transform", "translate(100,100)");

                x.domain(dataset1.map(function (d) {
                    return d.date;
                }));

                y.domain([0, d3.max(dataset1, function (d) {
                    return d.cases_avg;
                })]);

                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("dy", ".35em")
                    .attr("transform", "translate(-40,40) rotate(-45)")
                    .style("text-anchor", "start");

                g.append("g")
                    .append("text")
                    .attr("y", height + 70)
                    .attr("x", 300)
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "black")
                    .text("Date");

                g.append("g")
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -170)
                    .attr("y", 35)
                    .attr("dy", "-5.1em")
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "blue")
                    .text("Average Cases");

                g.append("g")
                    .attr("transform", "translate(0, 0)")
                    .call(d3.axisLeft(y))

                g.selectAll(".bar")
                    .data(dataset1)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("id", function (d) {
                        return "chart1_" + d.date;
                    })
                    .on("mouseover", onMouseOver)
                    .on("mouseout", onMouseOut)
                    .on("click", onMouseClick)
                    .attr("x", function (d) {
                        return x(d.date);
                    })
                    .attr("y", function (d) {
                        return y(d.cases_avg);
                    })
                    .attr("width", x.bandwidth()).transition()
                    .ease(d3.easeLinear).duration(100)
                    .delay(function (d, i) {
                        return i * 25;
                    })
                    .attr("height", function (d) {
                        return height - y(d.cases_avg);
                    });

                function onMouseOver(d, i) {
                    d3.select(this).attr('class', 'highlight');

                    d3.select(this)
                        .transition()
                        .duration(100)
                        .attr('width', x.bandwidth() + 5)
                        .attr("y", function (d) {
                            return y(d.cases_avg) - 10;
                        })
                        .attr("height", function (d) {
                            return height - y(d.cases_avg) + 10;
                        });

                    //console.log("cases_avg are:" + x(d.date));
                    svg1.append('text')
                        .attr('id', 'val' + i)
                        .attr('x', x(d.date) + 80)
                        .attr('y', y(d.cases_avg) + 80)
                        .text(d.cases_avg);
                }

                function onMouseOut(d, i) {
                    if (selectedIndex_svg1 != i) {
                        //console.log(maxCasesIndex1 +", "+minCasesIndex1+", date:"+dataset1[maxCasesIndex1]);
                        styleClass = "bar";
                        if (d.date == dataset1[maxCasesIndex1].date) {
                            styleClass = "tallestbar"
                        } else if (d.date == dataset1[minCasesIndex1].date) {
                            styleClass = "smallestbar";
                        }
                        d3.select(this).attr('class', styleClass);

                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('width', x.bandwidth())
                            .attr("y", function (d) {
                                return y(d.cases_avg);
                            })
                            .attr("height", function (d) {
                                return height - y(d.cases_avg);
                            });

                        d3.select('#val' + i).remove()
                    }
                }

                var selectedIndex_svg1 = -1;
                var selectedBar = null;

                function onMouseClick(d, i) {
                    if (selectedIndex_svg1 != i) {
                        if (selectedBar) {
                            styleClass = (dataset1[selectedIndex_svg1].date == dataset1[maxCasesIndex1].date) ? "tallestbar" :
                                (dataset1[selectedIndex_svg1].date == dataset1[minCasesIndex1].date) ? "smallestbar" : "bar";

                            d3.select(selectedBar).attr('class', styleClass);
                            d3.select('#val' + selectedIndex_svg1).remove()
                            d3.select(selectedBar)
                                .transition()
                                .duration(200)
                                .attr('width', x.bandwidth())
                                .attr("y", function (d) {
                                    return y(dataset1[selectedIndex_svg1].cases_avg);
                                })
                                .attr("height", function (d) {
                                    return height - y(dataset1[selectedIndex_svg1].cases_avg);
                                });
                        }
                        selectedBar = this
                        selectedIndex_svg1 = i
                        console.log(dataset1[i])
                        chart2(dataset1[i].date)

                        document.getElementById("svg2header1").style.display = "none";
                        document.getElementById("svg2title").style.display = "block";
                        document.getElementById('svg2title').scrollIntoView();
                        //document.getElementById("svg3title").style.display = "none";

                    }
                }

                maxCasesIndex1 = 0
                minCasesIndex1 = 0
                for (i = 0; i < dataset1.length; i++) {
                    //console.log(dataset1[i])
                    if (dataset1[i].cases_avg > dataset1[maxCasesIndex1].cases_avg) {
                        maxCasesIndex1 = i;
                    }
                    if (dataset1[i].cases_avg < dataset1[minCasesIndex1].cases_avg) {
                        minCasesIndex1 = i;
                    }
                }
                console.log("Maximum cases Index:" + maxCasesIndex1);
                console.log("Minimum cases Index:" + minCasesIndex1);

                svg1.selectAll("rect")
                    .attr("class", function (d) {
                        return (d.date == dataset1[maxCasesIndex1].date) ? "tallestbar" :
                            (d.date == dataset1[minCasesIndex1].date) ? "smallestbar" : "bar"
                    })

                // Features of the annotation
                const annotations = [
                    {
                        note: {
                            title: "Maximum Cases:" + dataset1[maxCasesIndex1].cases_avg,
                            //label: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 170, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset1[maxCasesIndex1].date) + 115,
                        y: y(dataset1[maxCasesIndex1].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              },
                    {
                        note: {
                            title: "Minimum Cases:" + dataset1[minCasesIndex1].cases_avg,
                            //title: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset1[minCasesIndex1].date) + 115,
                        y: y(dataset1[minCasesIndex1].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              }

            ]

                // Add annotation to the chart
                const makeAnnotations = d3.annotation()
                    .annotations(annotations)
                svg1
                    .append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations)
                    //onMouseOver(document.getElementById("#chart1_"+dataset1[maxCasesIndex1].date), maxCasesIndex1)
                    //onMouseClick(document.getElementById("#chart1_"+dataset1[maxCasesIndex1].date), maxCasesIndex1)
                    //onMouseOut(document.getElementById("#chart1_"+dataset1[maxCasesIndex1].date), maxCasesIndex1)

                //                if (showToolTip){
                //                    for(i=0;i<dataset1.length;i++){
                //                        var barData = d3.select("#chart1_"+dataset1[i].date)
                //                        barData
                //                        .transition()
                //                        .duration(500)
                //                        .attr('width', x.bandwidth() + 5)
                //                        .attr("y", y(dataset1[i].cases_avg) - 10)
                //                        .attr("height", height - y(dataset1[i].cases_avg) + 10);
                //                        
                //                        barData
                //                            .transition()
                //                            .duration(500)
                //                            .attr('width', x.bandwidth())
                //                            .attr("y", y(dataset1[i].cases_avg))
                //                            .attr("height", height - y(dataset1[i].cases_avg));
                //
                //                    }
                //                    
                //                }

            }


            function chart2(selectedDate) {

                dataset21 = dataset2
                dataset21 = dataset21.filter(function (el) {
                    //console.log(el)
                    cond = (el.date == selectedDate);
                    //console.log("State:"+el.state+", Year:"+el.date.substring(0,4)+", Month:"+el.date.substring(5,7)+", Include:"+ cond)
                    return cond;
                });
                //console.log(dataset21);
                var svg_chart2 = d3.select("#svg2");
                svg_chart2.html("");
                margin = 250;
                width = svg_chart2.attr("width") - margin;
                height = svg_chart2.attr("height") - margin;

                svg_chart2.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 10).attr("y", 30)
                    .attr("font-size", "20px")
                    .attr("class", "title")
                    .text("Average Cases By US States in " + selectedDate.substring(0, 7))

                var x = d3.scaleBand().range([0, width]).padding(0.6),
                    y = d3.scaleLinear().range([height, 0]);

                var g = svg_chart2.append("g")
                    .attr("transform", "translate(100,100)");

                x.domain(dataset21.map(function (d) {
                    return d.state;
                }));
                y.domain([0, d3.max(dataset21, function (d) {
                    return d.cases_avg;
                })]);

                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("dy", ".35em")
                    .attr("transform", "translate(-5,10) rotate(-45)")
                    .style("text-anchor", "end");

                g.append("g")
                    .append("text")
                    .attr("y", height + 80)
                    .attr("x", 250)
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "black")
                    .text("US States");

                g.append("g")
                    .append("text")
                    .attr("transform", "translate(-50," + (height - 70) + ") rotate(-90)")
                    //.attr("dy", "-5.1em")
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "blue")
                    .text("Average Cases");

                g.append("g")
                    .attr("transform", "translate(0, 0)")
                    .call(d3.axisLeft(y))

                g.selectAll(".bar")
                    .data(dataset21)
                    .enter()
                    .append("rect")
                    .filter(function (d) {
                        return d.date == selectedDate
                    })
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver2)
                    .on("mouseout", onMouseOut2)
                    .on("click", onMouseClick2)
                    .attr("x", function (d) {
                        return x(d.state);
                    })
                    .attr("y", function (d) {
                        return y(d.cases_avg);
                    })
                    .attr("width", x.bandwidth()).transition()
                    .ease(d3.easeLinear).duration(100)
                    .delay(function (d, i) {
                        return i * 25;
                    })
                    .attr("height", function (d) {
                        return height - y(d.cases_avg);
                    });

                function onMouseOver2(d, i) {
                    d3.select(this)
                        .attr('class', 'highlight');

                    d3.select(this)
                        .transition()
                        .duration(100)
                        .attr('width', x.bandwidth() + 5)
                        .attr("y", function (d) {
                            return y(d.cases_avg) - 10;
                        })
                        .attr("height", function (d) {
                            return height - y(d.cases_avg) + 10;
                        });

                    svg_chart2.append('text')
                        .attr('class', 'val')
                        .attr('x', x(d.state) + 80)
                        .attr('y', y(d.cases_avg) + 80)

                    .text(d.cases_avg);

                }

                function onMouseOut2(d, i) {
                    styleClass = (d.state == dataset21[maxcases_avgIndex2].state) ? "tallestbar" :
                        (d.state == dataset21[mincases_avgIndex2].state) ? "smallestbar" : "bar";
                    d3.select(this).attr('class', styleClass);


                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr('width', x.bandwidth())
                        .attr("y", function (d) {
                            return y(d.cases_avg);
                        })
                        .attr("height", function (d) {
                            return height - y(d.cases_avg);
                        });

                    d3.selectAll('.val').remove()
                }

                function onMouseClick2(d, i) {
                    //console.log("Selected:" + dataset21[i].cases_avg);
                    console.log("Selected:" + dataset21[i].state);
                    console.log("Selected:" + i);
                    //selectedIndex_svg2 = i
                    console.log(dataset21[i])
                    document.getElementById("svg3header1").style.display = "none";
                    document.getElementById("svg3title").style.display = "block";
                    document.getElementById('svg3title').scrollIntoView();
                    chart3(dataset21[i].date, dataset21[i].state)
                }

                maxcases_avgIndex2 = 0
                mincases_avgIndex2 = 0

                for (i = 0; i < dataset21.length; i++) {
                    if (dataset21[i].date == selectedDate) {
                        //console.log(dataset1[i])
                        if (dataset21[i].cases_avg > dataset21[maxcases_avgIndex2].cases_avg) {
                            maxcases_avgIndex2 = i;
                        }
                        if (dataset21[i].cases_avg < dataset21[mincases_avgIndex2].cases_avg) {
                            mincases_avgIndex2 = i;
                        }
                    }
                }
                console.log("Maximum Avg Cases_avg Index:" + maxcases_avgIndex2);
                console.log("Minimum cases_avg Index:" + mincases_avgIndex2);

                svg_chart2.selectAll("rect")
                    .attr("class", function (d) {
                        return (d.state == dataset21[maxcases_avgIndex2].state) ? "tallestbar" : (d.state == dataset21[mincases_avgIndex2].state) ? "smallestbar" : "bar"
                    })

                // Features of the annotation
                const annotations = [
                    {
                        note: {
                            title: "Maximum Avg Cases:" + dataset21[maxcases_avgIndex2].cases_avg,
                            //label: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset21[maxcases_avgIndex2].state) + 115,
                        y: y(dataset21[maxcases_avgIndex2].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              },
                    {
                        note: {
                            title: "Minimum Avg Cases:" + dataset21[mincases_avgIndex2].cases_avg,
                            //title: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset21[mincases_avgIndex2].state) + 115,
                        y: y(dataset21[mincases_avgIndex2].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              }

            ]

                // Add annotation to the chart
                const makeAnnotations = d3.annotation()
                    .annotations(annotations)
                svg_chart2
                    .append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations)

                onMouseClick2(null, maxcases_avgIndex2)
            }


            function chart3(selectedDate, selectedState) {
                //const dataset1 = d3.csv("./us-states.csv")
                stateDataset = dataset2
                stateDataset = stateDataset.filter(function (el) {
                    //console.log(el)
                    cond = ((el.state == selectedState) &&
                        (el.date.substring(0, 4) == selectedDate.substring(0, 4)) &&
                        (el.date.substring(5, 7) == selectedDate.substring(5, 7)));
                    //console.log("State:"+el.state+", Year:"+el.date.substring(0,4)+", Month:"+el.date.substring(5,7)+", Include:"+ cond)
                    return cond;
                });
                //console.log("stateDataset:"+stateDataset)
                var svg_chart3 = d3.select("#svg3");
                svg_chart3.html("");
                margin = 250;
                width = svg_chart3.attr("width") - margin;
                height = svg_chart3.attr("height") - margin;

                svg_chart3.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 10).attr("y", 30)
                    .attr("font-size", "20px")
                    .attr("class", "title")
                    .text("Daily Cases for " + selectedState + " in " + selectedDate.substring(0, 7))

                var x3 = d3.scaleBand().range([0, width]).padding(0.4),
                    y3 = d3.scaleLinear().range([height, 0]);

                var g = svg_chart3.append("g")
                    .attr("transform", "translate(100,100)");

                x3.domain(stateDataset.map(function (d) {
                    return d.date;
                }));
                y3.domain([0, d3.max(stateDataset, function (d) {
                    return d.cases;
                })]);

                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x3))
                    .selectAll("text")
                    .attr("dy", ".35em")
                    .attr("transform", "translate(-45,40) rotate(-45)")
                    .style("text-anchor", "start");

                g.append("g")
                    .append("text")
                    .attr("y", height + 70)
                    .attr("x", 250)
                    .attr("font-size", "18px")
                    .text("Date");

                g.append("g")
                    .append("text")
                    .attr("transform", "translate(-50," + (height - 70) + ") rotate(-90)")
                    .attr("font-size", "18px")
                    .text("Daily Cases");

                g.append("g")
                    .attr("transform", "translate(0, 0)")
                    .call(d3.axisLeft(y3))

                g.selectAll(".bar")
                    .data(stateDataset)
                    .enter()
                    .append("rect")
                    .filter(function (d) {
                        return (d.state == selectedState)
                    })
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver3)
                    .on("mouseout", onMouseOut3)
                    //.on("click", onMouseClick3)
                    .attr("x", function (d) {
                        return x3(d.date);
                    })
                    .attr("y", function (d) {
                        return y3(d.cases);
                    })
                    .attr("width", x3.bandwidth()).transition()
                    .ease(d3.easeLinear).duration(100)
                    .delay(function (d, i) {
                        return i * 25;
                    })
                    .attr("height", function (d) {
                        return height - y3(d.cases);
                    });


                function onMouseOver3(d, i) {
                    d3.select(this)
                        .attr('class', 'highlight');

                    d3.select(this)
                        .transition()
                        .duration(100)
                        .attr('width', x3.bandwidth() + 5)
                        .attr("y", function (d) {
                            return y3(d.cases) - 10;
                        })
                        .attr("height", function (d) {
                            return height - y3(d.cases) + 10;
                        });

                    console.log("Cases are:" + x3(d.date));
                    svg_chart3.append('text')
                        .attr('class', 'val')
                        //.attr("transform", "translate("+100+"," + 0+") rotate(-45)")
                        .attr('x', x3(d.date) + 80)
                        .attr('y', y3(d.cases) + 80)

                    .text(d.cases);

                }

                function onMouseOut3(d, i) {
                    styleClass = (d.date == stateDataset[maxCasesIndex3].date) ? "tallestbar" :
                        (d.date == stateDataset[minCasesIndex3].date) ? "smallestbar" : "bar";
                    d3.select(this)
                        .attr('class', styleClass);

                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr('width', x3.bandwidth())
                        .attr("y", function (d) {
                            return y3(d.cases);
                        })
                        .attr("height", function (d) {
                            return height - y3(d.cases);
                        });

                    d3.selectAll('.val')
                        .remove()
                }

                maxCasesIndex3 = 0
                minCasesIndex3 = 0
                for (i = 0; i < stateDataset.length; i++) {
                    if (stateDataset[i].state == selectedState) {
                        //console.log(dataset1[i])
                        if (stateDataset[i].cases > stateDataset[maxCasesIndex3].cases) {
                            maxCasesIndex3 = i;
                        }
                        if (stateDataset[i].cases < stateDataset[minCasesIndex3].cases) {
                            minCasesIndex3 = i;
                        }
                    }
                }

                svg_chart3.selectAll("rect")
                    .attr("class", function (d) {
                        return (d.date == stateDataset[maxCasesIndex3].date) ? "tallestbar" : (d.date == stateDataset[minCasesIndex3].date) ? "smallestbar" : "bar"
                    })

                // Features of the annotation
                const annotations3 = [
                    {
                        note: {
                            title: "Maximum Daily Cases:" + stateDataset[maxCasesIndex3].cases,
                            //label: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x3(stateDataset[maxCasesIndex3].date) + 115,
                        y: y3(stateDataset[maxCasesIndex3].cases) + 85,
                        dy: -20,
                        dx: 40
              },
                    {
                        note: {
                            title: "Minimum Daily Cases:" + stateDataset[minCasesIndex3].cases,
                            //title: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x3(stateDataset[minCasesIndex3].date) + 115,
                        y: y3(stateDataset[minCasesIndex3].cases) + 85,
                        dy: -20,
                        dx: 40
              }

            ]

                // Add annotation to the chart
                const makeAnnotations3 = d3.annotation().annotations(annotations3)
                svg_chart3
                    .append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations3)

            }
            document.getElementById("firstElement").scrollIntoView();
        </script>
    </div>
    <hr>
    <h4 align="center">Interactive Slideshow Created by Amit Agrawal(amita3@illinois.edu) CS416 Summer 2021</h4>
</body>

</html>
<html>

<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/1.12.1/d3-annotation.min.js"></script>
    <script>
        function show(num) {
            document.getElementById("svg" + num).focus();
        }
    </script>
    <title>Test - Amit</title>
    <style>
        .bar {
            fill: darkgreen;
        }
        
        .tallestbar {
            fill: yellow;
        }
        
        .smallestbar {
            fill: gray;
        }
        
        .highlight {
            fill: orange;
        }
        
        .title {
            fill: blue;
            font-weight: bold;
        }
        
        body {
            background-color: whitesmoke;
        }
        html {
          scroll-behavior: smooth;
        }
        
        td {
            border: 2px solid black;
        }
        
        :root {
            --line-chart-color: #607D8B;
            --annotation-context-color: #00796B;
            --annotation-above-color: #A02FA5;
            --annotation-anomaly-color: #E8336D;
        }
        
        svg {
            background-color: white;
            font-family: 'Lato';
        }
        
        .axis,
        .axis text {
            fill: var(--line-chart-color);
        }
        
        .axis line,
        path {
            stroke: var(--line-chart-color);
        }
        
        path {
            fill: none;
        }
        
        .annotation path {
            stroke: var(--annotation-context-color);
        }
        
        .annotation:not(.above):not(.anomaly) path {
            stroke-dasharray: 1, 3;
        }
        
        .annotation text {
            fill: var(--annotation-context-color);
        }
        
        .annotation.above path {
            stroke: var(--annotation-above-color);
        }
        
        .annotation.above text {
            fill: var(--annotation-above-color);
        }
        
        .annotation.anomaly path {
            stroke: var(--annotation-anomaly-color);
            stroke-width: 2px;
        }
        
        .annotation.anomaly text {
            fill: var(--annotation-anomaly-color);
        }
        
        .annotation-note-bg {
            fill: rgba(0, 0, 0, 0);
        }
        
        .annotation-note-title {
            font-weight: bold;
        }
        
        text.title {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>

<body onload='init()'>
    <div id="firstElement"></div>
    <h1 align="center"> COVID Data From March 2020 till July 2021</h1>
    <h4 align="center">Interactive Slideshow Created by Amit Agrawal(amita3@illinois.edu) CS416 Summer 2021</h4>
    <br>
    <div>
        <table id="svg1header2" cellpadding=10>
            <tr>
                <th>Slides: </th>
                <td bgcolor="orange">1</td>
                <td><a href="#svg2header2">2</a></td>
                <td><a href="#svg3header2">3</a></td>
            </tr>
        </table>

        <h5>Click on Bars to see average cases by US states for the selected Date in next slide.</h5>
        <svg id="svg1" width="1200" height="500"></svg>
        

        <div id="svg2header2">
            <h5 id="svg2header1">Please select Month in slide 1.</h5>
            <h5 id="svg2title">Click on Bars to see Daily cases in selected Month and US State in next slide.</h5>
            <table id="svg2slideTbl" cellpadding=10>
                <tr>
                    <th>Slides: </th>
                    <td><a href="#svg1header2">1</a></td>
                    <td bgcolor="orange">2</td>
                    <td><a href="#svg3header2">3</a></td>
                </tr>
            </table>

            
            <svg id="svg2" width="1200" height="500"></svg>
            
            <div  id="svg3header2">
                <h5 id="svg3header1">Please select Month and US State in slide 2.</h5>
                <h5  id="svg3title">Showing Daily cases in selected Month and US State.</h5>
                <table id="svg3slideTbl" cellpadding=10>
                    <tr>
                        <th>Slides: </th>
                        <td><a href="#svg1header2">1</a></td>
                        <td><a href="#svg2header2">2</a></td>
                        <td bgcolor="orange">3</td>
                    </tr>
                </table>

                
                <svg id="svg3" width="1200" height="500"></svg>
            </div>
        </div>
        <script>
            var dataset1;
            var dataset2;

            document.getElementById("svg2title").style.display = "none";
            document.getElementById("svg3title").style.display = "none";


            async function init() {
                dataset1 = await d3.csv("./us.csv", ({date, cases, cases_avg}) => ({date: date,cases: +cases,cases_avg: +cases_avg}))
                dataset2 = await d3.csv("./us-states.csv", ({date, state, cases, cases_avg, deaths}) => ({date: date,state: state,cases: +cases,cases_avg: +cases_avg,deaths: +deaths}))

                adataset1 = [
                    {
                        date: '2020-04-30',
                        cases_avg: 20974.14
                },
                    {
                        date: '2020-05-31',
                        cases_avg: 22791.14
                },
                    {
                        date: '2020-04-03',
                        cases_avg: 24932.29
                },
                    {
                        date: '2020-04-04',
                        cases_avg: 26937
                },
                    {
                        date: '2020-04-05',
                        cases_avg: 27950.71
                },
                    {
                        date: '2020-04-06',
                        cases_avg: 29300.29
                },
                    {
                        date: '2020-04-07',
                        cases_avg: 30133.29
                },
                    {
                        date: '2020-04-08',
                        cases_avg: 30831.86
                },
                    {
                        date: '2020-04-09',
                        cases_avg: 31543.57
                },
                    {
                        date: '2020-04-10',
                        cases_avg: 31708.57
                },
                    {
                        date: '2020-04-11',
                        cases_avg: 31225.86
                },
                    {
                        date: '2020-04-12',
                        cases_avg: 31444
                },
                    {
                        date: '2020-04-13',
                        cases_avg: 30708.71
                },
                    {
                        date: '2020-04-14',
                        cases_avg: 30187.86
                },
                    {
                        date: '2020-04-15',
                        cases_avg: 29932.57
                },
        ]
                adataset2 = [
                        {
                            date: '2020-04-01',
                            state: 'Washington',
                            cases_avg: 124.14,
                            cases: 124.14
                },
                        {
                            date: '2020-04-30',
                            state: 'Massachusetts',
                            cases_avg: 204.14,
                            cases: 224.14
                },
                        {
                            date: '2020-04-30',
                            state: 'Northern Mariana Islands',
                            cases_avg: 600.14,
                            cases: 624.14
                },
                        {
                            date: '2020-04-30',
                            state: 'Washington',
                            cases_avg: 323,
                            cases: 324.14
                },
                        {
                            date: '2020-05-31',
                            state: 'Massachusetts',
                            cases_avg: 500,
                            cases: 624.14
                },
                        {
                            date: '2020-05-31',
                            state: 'Northern Mariana Islands',
                            cases_avg: 1300.14,
                            cases: 1324.14
                },
                        {
                            date: '2020-04-03',
                            state: 'CT',
                            cases_avg: 1574.14,
                            cases: 1524.14
                },
                        {
                            date: '2020-04-03',
                            state: 'Massachusetts',
                            cases_avg: 2704.14,
                            cases: 2124.14
                },
                        {
                            date: '2020-04-03',
                            state: 'NY',
                            cases_avg: 6300.14,
                            cases: 6124.14
                },
        ]
                    //'2020-01-31','2020-02-29',
                var monthendDates = ['2020-03-31', '2020-04-30', '2020-05-31', '2020-06-30', '2020-07-31',
                                   '2020-08-31', '2020-09-30', '2020-10-31', '2020-11-30', '2020-12-31', '2021-01-31', '2021-02-28',
                                  '2021-03-31', '2021-04-30', '2021-05-31', '2021-06-30', '2021-07-31']


                dataset1 = dataset1.filter(function (el) {
                    return monthendDates.includes(el.date);
                });

                excludeStates = ["Northern Mariana Islands", "Guam", "Virgin Islands"]
                dataset2 = dataset2.filter(function (el) {
                    return !excludeStates.includes(el.state);
                });


                var svg1 = d3.select("#svg1");
                margin = 250;
                width = svg1.attr("width") - margin;
                height = svg1.attr("height") - margin;

                svg1.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 10).attr("y", 50)
                    .attr("font-size", "20px")
                    .attr("class", "title")
                    .text("Average COVID Cases in USA")

                var x = d3.scaleBand().range([0, width]).padding(0.6),
                    y = d3.scaleLinear().range([height, 0]);

                var g = svg1.append("g")
                    .attr("transform", "translate(100,100)");

                x.domain(dataset1.map(function (d) {
                    return d.date;
                }));

                y.domain([0, d3.max(dataset1, function (d) {
                    return d.cases_avg;
                })]);

                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("dy", ".35em")
                    .attr("transform", "translate(-40,40) rotate(-45)")
                    .style("text-anchor", "start");

                g.append("g")
                    .append("text")
                    .attr("y", height + 70)
                    .attr("x", 300)
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "black")
                    .text("Date");

                g.append("g")
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -170)
                    .attr("y", 35)
                    .attr("dy", "-5.1em")
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "blue")
                    .text("Average Cases");

                g.append("g")
                    .attr("transform", "translate(0, 0)")
                    .call(d3.axisLeft(y))

                g.selectAll(".bar")
                    .data(dataset1)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("id", function (d) {
                        return "chart1_" + d.date;
                    })
                    .on("mouseover", onMouseOver)
                    .on("mouseout", onMouseOut)
                    .on("click", onMouseClick)
                    .attr("x", function (d) {
                        return x(d.date);
                    })
                    .attr("y", function (d) {
                        return y(d.cases_avg);
                    })
                    .attr("width", x.bandwidth()).transition()
                    .ease(d3.easeLinear).duration(100)
                    .delay(function (d, i) {
                        return i * 25;
                    })
                    .attr("height", function (d) {
                        return height - y(d.cases_avg);
                    });

                function onMouseOver(d, i) {
                    d3.select(this).attr('class', 'highlight');

                    d3.select(this)
                        .transition()
                        .duration(100)
                        .attr('width', x.bandwidth() + 5)
                        .attr("y", function (d) {
                            return y(d.cases_avg) - 10;
                        })
                        .attr("height", function (d) {
                            return height - y(d.cases_avg) + 10;
                        });

                    //console.log("cases_avg are:" + x(d.date));
                    svg1.append('text')
                        .attr('id', 'val' + i)
                        .attr('x', x(d.date) + 80)
                        .attr('y', y(d.cases_avg) + 80)
                        .text(d.cases_avg);
                }

                function onMouseOut(d, i) {
                    if (selectedIndex_svg1 != i) {
                        //console.log(maxCasesIndex1 +", "+minCasesIndex1+", date:"+dataset1[maxCasesIndex1]);
                        styleClass = "bar";
                        if (d.date == dataset1[maxCasesIndex1].date) {
                            styleClass = "tallestbar"
                        } else if (d.date == dataset1[minCasesIndex1].date) {
                            styleClass = "smallestbar";
                        }
                        d3.select(this).attr('class', styleClass);

                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr('width', x.bandwidth())
                            .attr("y", function (d) {
                                return y(d.cases_avg);
                            })
                            .attr("height", function (d) {
                                return height - y(d.cases_avg);
                            });

                        d3.select('#val' + i).remove()
                    }
                }

                var selectedIndex_svg1 = -1;
                var selectedBar = null;

                function onMouseClick(d, i) {
                    if (selectedIndex_svg1 != i) {
                        if (selectedBar) {
                            styleClass = (dataset1[selectedIndex_svg1].date == dataset1[maxCasesIndex1].date) ? "tallestbar" :
                                (dataset1[selectedIndex_svg1].date == dataset1[minCasesIndex1].date) ? "smallestbar" : "bar";

                            d3.select(selectedBar).attr('class', styleClass);
                            d3.select('#val' + selectedIndex_svg1).remove()
                            d3.select(selectedBar)
                                .transition()
                                .duration(200)
                                .attr('width', x.bandwidth())
                                .attr("y", function (d) {
                                    return y(dataset1[selectedIndex_svg1].cases_avg);
                                })
                                .attr("height", function (d) {
                                    return height - y(dataset1[selectedIndex_svg1].cases_avg);
                                });
                        }
                        selectedBar = this
                        selectedIndex_svg1 = i
                        console.log(dataset1[i])
                        chart2(dataset1[i].date)
                        
                        document.getElementById("svg2header1").style.display = "none";
                        document.getElementById("svg2title").style.display = "block";
                        document.getElementById('svg2title').scrollIntoView();
            //document.getElementById("svg3title").style.display = "none";

                    }
                }

                maxCasesIndex1 = 0
                minCasesIndex1 = 0
                for (i = 0; i < dataset1.length; i++) {
                    //console.log(dataset1[i])
                    if (dataset1[i].cases_avg > dataset1[maxCasesIndex1].cases_avg) {
                        maxCasesIndex1 = i;
                    }
                    if (dataset1[i].cases_avg < dataset1[minCasesIndex1].cases_avg) {
                        minCasesIndex1 = i;
                    }
                }
                console.log("Maximum cases Index:" + maxCasesIndex1);
                console.log("Minimum cases Index:" + minCasesIndex1);

                svg1.selectAll("rect")
                    .attr("class", function (d) {
                        return (d.date == dataset1[maxCasesIndex1].date) ? "tallestbar" :
                            (d.date == dataset1[minCasesIndex1].date) ? "smallestbar" : "bar"
                    })

                // Features of the annotation
                const annotations = [
                    {
                        note: {
                            title: "Maximum Cases:" + dataset1[maxCasesIndex1].cases_avg,
                            //label: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 170, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset1[maxCasesIndex1].date) + 115,
                        y: y(dataset1[maxCasesIndex1].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              },
                    {
                        note: {
                            title: "Minimum Cases:" + dataset1[minCasesIndex1].cases_avg,
                            //title: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset1[minCasesIndex1].date) + 115,
                        y: y(dataset1[minCasesIndex1].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              }

            ]

                // Add annotation to the chart
                const makeAnnotations = d3.annotation()
                    .annotations(annotations)
                svg1
                    .append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations)
                    //onMouseOver(document.getElementById("#chart1_"+dataset1[maxCasesIndex1].date), maxCasesIndex1)
                    //onMouseClick(document.getElementById("#chart1_"+dataset1[maxCasesIndex1].date), maxCasesIndex1)
                    //onMouseOut(document.getElementById("#chart1_"+dataset1[maxCasesIndex1].date), maxCasesIndex1)
            }


            function chart2(selectedDate) {

                dataset21 = dataset2
                dataset21 = dataset21.filter(function (el) {
                    //console.log(el)
                    cond = (el.date == selectedDate);
                    //console.log("State:"+el.state+", Year:"+el.date.substring(0,4)+", Month:"+el.date.substring(5,7)+", Include:"+ cond)
                    return cond;
                });
                //console.log(dataset21);
                var svg_chart2 = d3.select("#svg2");
                svg_chart2.html("");
                margin = 250;
                width = svg_chart2.attr("width") - margin;
                height = svg_chart2.attr("height") - margin;

                svg_chart2.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 10).attr("y", 30)
                    .attr("font-size", "20px")
                    .attr("class", "title")
                    .text("Average Cases By US States in " + selectedDate.substring(0, 7))

                var x = d3.scaleBand().range([0, width]).padding(0.6),
                    y = d3.scaleLinear().range([height, 0]);

                var g = svg_chart2.append("g")
                    .attr("transform", "translate(100,100)");

                x.domain(dataset21.map(function (d) {
                    return d.state;
                }));
                y.domain([0, d3.max(dataset21, function (d) {
                    return d.cases_avg;
                })]);

                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("dy", ".35em")
                    .attr("transform", "translate(-5,10) rotate(-45)")
                    .style("text-anchor", "end");

                g.append("g")
                    .append("text")
                    .attr("y", height + 80)
                    .attr("x", 250)
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "black")
                    .text("US States");

                g.append("g")
                    .append("text")
                    .attr("transform", "translate(-50," + (height - 70) + ") rotate(-90)")
                    //.attr("dy", "-5.1em")
                    //.attr("text-anchor", "end")
                    .attr("font-size", "18px")
                    //.attr("stroke", "blue")
                    .text("Average Cases");

                g.append("g")
                    .attr("transform", "translate(0, 0)")
                    .call(d3.axisLeft(y))

                g.selectAll(".bar")
                    .data(dataset21)
                    .enter()
                    .append("rect")
                    .filter(function (d) {
                        return d.date == selectedDate
                    })
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver2)
                    .on("mouseout", onMouseOut2)
                    .on("click", onMouseClick2)
                    .attr("x", function (d) {
                        return x(d.state);
                    })
                    .attr("y", function (d) {
                        return y(d.cases_avg);
                    })
                    .attr("width", x.bandwidth()).transition()
                    .ease(d3.easeLinear).duration(100)
                    .delay(function (d, i) {
                        return i * 25;
                    })
                    .attr("height", function (d) {
                        return height - y(d.cases_avg);
                    });

                function onMouseOver2(d, i) {
                    d3.select(this)
                        .attr('class', 'highlight');

                    d3.select(this)
                        .transition()
                        .duration(100)
                        .attr('width', x.bandwidth() + 5)
                        .attr("y", function (d) {
                            return y(d.cases_avg) - 10;
                        })
                        .attr("height", function (d) {
                            return height - y(d.cases_avg) + 10;
                        });

                    svg_chart2.append('text')
                        .attr('class', 'val')
                        .attr('x', x(d.state) + 80)
                        .attr('y', y(d.cases_avg) + 80)

                    .text(d.cases_avg);

                }

                function onMouseOut2(d, i) {
                    styleClass = (d.state == dataset21[maxcases_avgIndex2].state) ? "tallestbar" :
                        (d.state == dataset21[mincases_avgIndex2].state) ? "smallestbar" : "bar";
                    d3.select(this).attr('class', styleClass);


                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr('width', x.bandwidth())
                        .attr("y", function (d) {
                            return y(d.cases_avg);
                        })
                        .attr("height", function (d) {
                            return height - y(d.cases_avg);
                        });

                    d3.selectAll('.val').remove()
                }

                function onMouseClick2(d, i) {
                    //console.log("Selected:" + dataset21[i].cases_avg);
                    console.log("Selected:" + dataset21[i].state);
                    console.log("Selected:" + i);
                    //selectedIndex_svg2 = i
                    console.log(dataset21[i])
                    document.getElementById("svg3header1").style.display = "none";
                    document.getElementById("svg3title").style.display = "block";
                    document.getElementById('svg3title').scrollIntoView();
                    chart3(dataset21[i].date, dataset21[i].state)
                }

                maxcases_avgIndex2 = 0
                mincases_avgIndex2 = 0

                for (i = 0; i < dataset21.length; i++) {
                    if (dataset21[i].date == selectedDate) {
                        //console.log(dataset1[i])
                        if (dataset21[i].cases_avg > dataset21[maxcases_avgIndex2].cases_avg) {
                            maxcases_avgIndex2 = i;
                        }
                        if (dataset21[i].cases_avg < dataset21[mincases_avgIndex2].cases_avg) {
                            mincases_avgIndex2 = i;
                        }
                    }
                }
                console.log("Maximum Avg Cases_avg Index:" + maxcases_avgIndex2);
                console.log("Minimum cases_avg Index:" + mincases_avgIndex2);

                svg_chart2.selectAll("rect")
                    .attr("class", function (d) {
                        return (d.state == dataset21[maxcases_avgIndex2].state) ? "tallestbar" : (d.state == dataset21[mincases_avgIndex2].state) ? "smallestbar" : "bar"
                    })

                // Features of the annotation
                const annotations = [
                    {
                        note: {
                            title: "Maximum Avg Cases:" + dataset21[maxcases_avgIndex2].cases_avg,
                            //label: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset21[maxcases_avgIndex2].state) + 115,
                        y: y(dataset21[maxcases_avgIndex2].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              },
                    {
                        note: {
                            title: "Minimum Avg Cases:" + dataset21[mincases_avgIndex2].cases_avg,
                            //title: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x(dataset21[mincases_avgIndex2].state) + 115,
                        y: y(dataset21[mincases_avgIndex2].cases_avg) + 85,
                        dy: -20,
                        dx: 40
              }

            ]

                // Add annotation to the chart
                const makeAnnotations = d3.annotation()
                    .annotations(annotations)
                svg_chart2
                    .append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations)

                onMouseClick2(null, maxcases_avgIndex2)
            }


            function chart3(selectedDate, selectedState) {
                //const dataset1 = d3.csv("./us-states.csv")
                stateDataset = dataset2
                stateDataset = stateDataset.filter(function (el) {
                    //console.log(el)
                    cond = ((el.state == selectedState) &&
                        (el.date.substring(0, 4) == selectedDate.substring(0, 4)) &&
                        (el.date.substring(5, 7) == selectedDate.substring(5, 7)));
                    //console.log("State:"+el.state+", Year:"+el.date.substring(0,4)+", Month:"+el.date.substring(5,7)+", Include:"+ cond)
                    return cond;
                });
                //console.log("stateDataset:"+stateDataset)
                var svg_chart3 = d3.select("#svg3");
                svg_chart3.html("");
                margin = 250;
                width = svg_chart3.attr("width") - margin;
                height = svg_chart3.attr("height") - margin;

                svg_chart3.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 10).attr("y", 30)
                    .attr("font-size", "20px")
                    .attr("class", "title")
                    .text("Daily Cases for " + selectedState + " in " + selectedDate.substring(0, 7))

                var x3 = d3.scaleBand().range([0, width]).padding(0.4),
                    y3 = d3.scaleLinear().range([height, 0]);

                var g = svg_chart3.append("g")
                    .attr("transform", "translate(100,100)");

                x3.domain(stateDataset.map(function (d) {
                    return d.date;
                }));
                y3.domain([0, d3.max(stateDataset, function (d) {
                    return d.cases;
                })]);

                g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x3))
                    .selectAll("text")
                    .attr("dy", ".35em")
                    .attr("transform", "translate(-45,40) rotate(-45)")
                    .style("text-anchor", "start");

                g.append("g")
                    .append("text")
                    .attr("y", height + 70)
                    .attr("x", 250)
                    .attr("font-size", "18px")
                    .text("Date");

                g.append("g")
                    .append("text")
                    .attr("transform", "translate(-50," + (height - 70) + ") rotate(-90)")
                    .attr("font-size", "18px")
                    .text("Daily Cases");

                g.append("g")
                    .attr("transform", "translate(0, 0)")
                    .call(d3.axisLeft(y3))

                g.selectAll(".bar")
                    .data(stateDataset)
                    .enter()
                    .append("rect")
                    .filter(function (d) {
                        return (d.state == selectedState)
                    })
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver3)
                    .on("mouseout", onMouseOut3)
                    //.on("click", onMouseClick3)
                    .attr("x", function (d) {
                        return x3(d.date);
                    })
                    .attr("y", function (d) {
                        return y3(d.cases);
                    })
                    .attr("width", x3.bandwidth()).transition()
                    .ease(d3.easeLinear).duration(100)
                    .delay(function (d, i) {
                        return i * 25;
                    })
                    .attr("height", function (d) {
                        return height - y3(d.cases);
                    });


                function onMouseOver3(d, i) {
                    d3.select(this)
                        .attr('class', 'highlight');

                    d3.select(this)
                        .transition()
                        .duration(100)
                        .attr('width', x3.bandwidth() + 5)
                        .attr("y", function (d) {
                            return y3(d.cases) - 10;
                        })
                        .attr("height", function (d) {
                            return height - y3(d.cases) + 10;
                        });

                    console.log("Cases are:" + x3(d.date));
                    svg_chart3.append('text')
                        .attr('class', 'val')
                        //.attr("transform", "translate("+100+"," + 0+") rotate(-45)")
                        .attr('x', x3(d.date) + 80)
                        .attr('y', y3(d.cases) + 80)

                    .text(d.cases);

                }

                function onMouseOut3(d, i) {
                    styleClass = (d.date == stateDataset[maxCasesIndex3].date) ? "tallestbar" :
                        (d.date == stateDataset[minCasesIndex3].date) ? "smallestbar" : "bar";
                    d3.select(this)
                        .attr('class', styleClass);

                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr('width', x3.bandwidth())
                        .attr("y", function (d) {
                            return y3(d.cases);
                        })
                        .attr("height", function (d) {
                            return height - y3(d.cases);
                        });

                    d3.selectAll('.val')
                        .remove()
                }

                maxCasesIndex3 = 0
                minCasesIndex3 = 0
                for (i = 0; i < stateDataset.length; i++) {
                    if (stateDataset[i].state == selectedState) {
                        //console.log(dataset1[i])
                        if (stateDataset[i].cases > stateDataset[maxCasesIndex3].cases) {
                            maxCasesIndex3 = i;
                        }
                        if (stateDataset[i].cases < stateDataset[minCasesIndex3].cases) {
                            minCasesIndex3 = i;
                        }
                    }
                }

                svg_chart3.selectAll("rect")
                    .attr("class", function (d) {
                        return (d.date == stateDataset[maxCasesIndex3].date) ? "tallestbar" : (d.date == stateDataset[minCasesIndex3].date) ? "smallestbar" : "bar"
                    })

                // Features of the annotation
                const annotations3 = [
                    {
                        note: {
                            title: "Maximum Daily Cases:" + stateDataset[maxCasesIndex3].cases,
                            //label: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x3(stateDataset[maxCasesIndex3].date) + 115,
                        y: y3(stateDataset[maxCasesIndex3].cases) + 85,
                        dy: -20,
                        dx: 40
              },
                    {
                        note: {
                            title: "Minimum Daily Cases:" + stateDataset[minCasesIndex3].cases,
                            //title: "Annotation title",
                            //align: "middle",  // try right or left
                            wrap: 200, // try something smaller to see text split in several lines
                            padding: 10 // More = text lower
                        },
                        className: "anomaly",
                        type: d3.annotationCalloutElbow,
                        connector: {
                            end: "arrow"
                        },
                        x: x3(stateDataset[minCasesIndex3].date) + 115,
                        y: y3(stateDataset[minCasesIndex3].cases) + 85,
                        dy: -20,
                        dx: 40
              }

            ]

                // Add annotation to the chart
                const makeAnnotations3 = d3.annotation().annotations(annotations3)
                svg_chart3
                    .append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations3)

            }
            document.getElementById("firstElement").scrollIntoView();
        </script>
    </div>
    <h4 align="center">Interactive Slideshow Created by Amit Agrawal(amita3@illinois.edu) CS416 Summer 2021</h4>
</body>

</html>
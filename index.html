<html>
    <head>
    <script src = "https://d3js.org/d3.v4.min.js"></script>
    <title>Test - Amit</title>
    <style>
   .bar {
      fill: green;
   }
   
   .highlight {
      fill: red;
   }
   
   .title {
      fill: blue;
      font-weight: bold;
   }
</style>
    </head>
    
<body>
    B
    <svg id="svg1" width = "800" height = "500"></svg>
    <svg id="svg1" width = "800" height = "500"></svg>
      <script>
        const dataset = d3.csv("./us.csv")
        var dataset1 = [
            
            {date:'2020-04-01',cases_avg:20974.14},
            {date:'2020-04-02',cases_avg:22791.14},
            {date:'2020-04-03',cases_avg:24932.29},
            {date:'2020-04-04',cases_avg:26937},
            {date:'2020-04-05',cases_avg:27950.71},
            {date:'2020-04-06',cases_avg:29300.29},
            
            
        ]  
        
        
          
         var svg1 = d3.select("#svg1");
         margin = 250; 
         width = svg1.attr("width") - margin;
         height = svg1.attr("height") - margin;
         
         svg1.append("text")
            .attr("transform", "translate(100,0)")
            .attr("x", 50).attr("y", 50)
            .attr("font-size", "20px")
            .attr("class", "title")
            .text("cases_avg bar chart")
            
         var x = d3.scaleBand().range([0, width]).padding(0.4),
         y = d3.scaleLinear().range([height, 0]);           
          
         var g = svg1.append("g")
            .attr("transform", "translate(100,100)");

        x.domain(dataset.map(function(d) { return d.date; }));
        y.domain([0, d3.max(dataset, function(d) { return d.cases_avg; })]);

        g.append("g")
           .attr("transform", "translate(0," + height + ")")
           .call(d3.axisBottom(x))
           .append("text")
           .attr("y", height - 250)
           .attr("x", width - 100)
           //.attr("text-anchor", "end")
           .attr("font-size", "18px")
           //.attr("stroke", "blue")
           .text("Date");

        g.append("g")
           .append("text")
           .attr("transform", "rotate(-90)")
           .attr("y", 6)
           .attr("dy", "-5.1em")
           //.attr("text-anchor", "end")
           .attr("font-size", "18px")
           //.attr("stroke", "blue")
           .text("Average Cases");

        g.append("g")
           .attr("transform", "translate(0, 0)")
           .call(d3.axisLeft(y))

        g.selectAll(".bar")
           .data(dataset)
           .enter()
           .append("rect")
           .attr("class", "bar")
           .on("mouseover", onMouseOver) 
           .on("mouseout", onMouseOut)   
           .on("click", onMouseClick)
           .attr("x", function(d) { return x(d.date); })            
           .attr("y", function(d) { return y(d.cases_avg); })
           .attr("width", x.bandwidth()).transition()
           .ease(d3.easeLinear).duration(100)
           .delay(function (d, i) {
              return i * 25;
           }) 
        .attr("height", function(d) { return height - y(d.cases_avg); });

          
            //.selectAll(".xaxis text") // Select all the text elements for the xaxis
        //.attr("transform", function(d) {return "rotate(-45)";});
        
          
//        g.selectAll(".xaxis text") // Select all the text elements for the xaxis
//        .attr("transform", function(d) {return "rotate(-45)";});
//  
          
         function onMouseOver(d, i) {
            d3.select(this)
            //.attr('class', 'highlight')
            .attr('fill', 'orange');
              
               
            d3.select(this)
               .transition()     
               .duration(100)
               .attr('width', x.bandwidth() + 5)
               .attr("y", function(d) { return y(d.cases_avg) - 10; })
               .attr("height", function(d) { return height - y(d.cases_avg) + 10; });
             
            console.log("Cases are:" + d.cases_avg); 
            svg1.append("text").attr({
                        id: "r" + d.date +"-",
                        x: function() {return x(d.date) -30;},
                        y: function() {return y(d.cases_avg) - 50;}
                     })
               .text(function(){return "Cases are:";});
             
            //alert(d.cases_avg);
//            // Specify where to put label of text
//            svg1.append("text").attr({
//               id: "t" + d.x + "-" + d.y + "-" + i,  // Create an id for text so we can select it later for removing on mouseout
//                x: function() { return xScale(d.x) - 30; },
//                y: function() { return yScale(d.y) - 15; }
//            })
//            .text(function() {
//              return [d.x, d.y];  // Value of the text
//            });
//            
            
         }
          
         function onMouseOut(d, i) {
             
            d3.select(this)
               .attr('class', 'bar')
               .attr('fill', 'black');
             
            d3.select(this)
               .transition()     
               .duration(200)
               .attr('width', x.bandwidth())
               .attr("y", function(d) { return y(d.cases_avg); })
               .attr("height", function(d) { return height - y(d.cases_avg); });
            
            d3.selectAll('.val')
               .remove()
         }
          
        var selectedIndex_svg1 = -1;
        function onMouseClick(d, i){
            console.log("Selected:"+d.cases_avg);
            console.log("Selected:"+d.date);
            console.log("Selected:"+i);
            selectedIndex_svg1 = i
        }  
          
          
      </script>
    
</body>
</html>
